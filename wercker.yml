box: node

front-build:
    steps:

        - script:
            name: install dependencies with yarn ( front )
            cwd: front
            code: |
                npm install -g yarn --quiet --depth 0
                export YARN_CACHE=$WERCKER_CACHE_DIR/yarn
                HOME=$YARN_CACHE yarn --pure-lockfile

        - script:
            name: install dependencies with yarn ( back )
            cwd: back
            code: |
                npm install -g yarn --quiet --depth 0
                export YARN_CACHE=$WERCKER_CACHE_DIR/yarn
                HOME=$YARN_CACHE yarn --pure-lockfile

        - script:
            name: build multi
            cwd: front
            code: yarn run build

        - script:
            name: bundle multi
            code: |
                mkdir dist
                mv front/dist/* dist

        - script:
            name: prepare standalone
            code: node script/prepare_standalone.js

        - script:
            name: build standalone
            cwd: front
            code: yarn run build

        - script:
            name: bundle standalone
            code: |
                mkdir dist/standalone
                mv front/dist/* dist/standalone

front-deploy:
    steps:
        - takuma7/gh-pages:
            token: $GH_TOKEN
            basedir: ./dist